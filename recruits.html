<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Serra Football Recruits</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Password Protection -->
<script>
if (sessionStorage.getItem("serraCoachAccess") !== "true") {
  window.location.href = "coach-login.html";
}
</script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --serra-red: #7a1419;
  --serra-dark: #4a0d10;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
  background: linear-gradient(180deg, var(--serra-dark), var(--serra-red));
  color: #fff;
}

/* TOP BAR */
.topbar {
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(6px);
  padding: 12px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 900;
}

.brand img {
  height: 40px;
}

.nav a {
  color: #fff;
  text-decoration: none;
  font-weight: 800;
  margin-left: 16px;
}

/* LAYOUT */
.container {
  max-width: 1200px;
  margin: auto;
  padding: 22px;
}

/* SEARCH + FILTERS */
.controls {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 22px;
}

.controls input {
  padding: 12px 18px;
  border-radius: 999px;
  border: none;
  font-size: 1rem;
}

.filters {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.filters button {
  padding: 8px 16px;
  border-radius: 999px;
  border: none;
  background: rgba(255,255,255,.18);
  color: #fff;
  font-weight: 800;
  cursor: pointer;
}

.filters button.active {
  background: #fff;
  color: var(--serra-red);
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 18px;
}

/* CARD */
.card {
  background: rgba(0,0,0,.35);
  border-radius: 18px;
  padding: 14px;
  text-align: center;
}

/* ✅ HEAD → WAIST IMAGE CROP (FINAL) */
.card img {
  width: 100%;
  aspect-ratio: 3 / 4;        /* portrait framing */
  object-fit: cover;
  object-position: 50% 15%;   /* helmet → chest → number */
  transform: scale(1.03);     /* subtle pro zoom */
  border-radius: 14px;
  margin-bottom: 10px;
}

/* TEXT */
.name {
  font-size: 1.15rem;
  font-weight: 900;
}

.meta {
  font-size: .92rem;
  opacity: .95;
}

/* ACTIONS */
.actions {
  margin-top: 10px;
  display: flex;
  justify-content: center;
  gap: 10px;
}

.btn {
  padding: 8px 14px;
  border-radius: 999px;
  font-size: .85rem;
  font-weight: 900;
  text-decoration: none;
}

.profile {
  background: #fff;
  color: var(--serra-red);
}

.twitter {
  background: #1da1f2;
  color: #fff;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">
    <img src="images/serra_logo.png" alt="Serra Logo">
    Serra Football Recruits
  </div>
  <div class="nav">
    <a href="index.html">Home</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</div>

<div class="container">

  <div class="controls">
    <input id="search" placeholder="Search by name or position">

    <div class="filters">
      <button class="active" data-class="all">All</button>
      <button data-class="2026">2026</button>
      <button data-class="2027">2027</button>
      <button data-class="2028">2028</button>
      <button data-class="2029">2029</button>
    </div>
  </div>

  <div id="grid" class="grid"></div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRZdfePIY8K8ag6AePllWRgYXhjJ-gJddB_8rDaJi3t5BAT11bHVK6m5cDsDQXg2PUIYPqHYcXyxbT2/pub?output=csv";

let players = [];
let activeClass = "all";

function logout() {
  sessionStorage.removeItem("serraCoachAccess");
  window.location.href = "coach-login.html";
}

/* SAFE CSV PARSER */
function parseCSV(text) {
  const rows = [];
  let row = [], field = "", inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const c = text[i];
    if (inQuotes) {
      if (c === '"') {
        if (text[i + 1] === '"') { field += '"'; i++; }
        else inQuotes = false;
      } else field += c;
    } else {
      if (c === '"') inQuotes = true;
      else if (c === ',') { row.push(field); field = ""; }
      else if (c === '\n') { row.push(field); rows.push(row); row = []; field = ""; }
      else if (c !== '\r') field += c;
    }
  }
  if (field || row.length) { row.push(field); rows.push(row); }
  return rows;
}

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    const rows = parseCSV(text);
    const headers = rows[0];

    players = rows.slice(1).map(r => {
      let o = {};
      headers.forEach((h, i) => o[h] = r[i] || "");
      return o;
    }).filter(p => p.Name);

    render();
  });

function render() {
  const grid = document.getElementById("grid");
  const q = document.getElementById("search").value.toLowerCase();
  grid.innerHTML = "";

  players
    .filter(p =>
      (activeClass === "all" || p.Class === activeClass) &&
      (`${p.Name} ${p.Position}`.toLowerCase().includes(q))
    )
    .forEach(p => {
      grid.innerHTML += `
        <div class="card">
          <img src="${p.ImageURL || 'images/placeholder_player.png'}"
               onerror="this.src='images/placeholder_player.png'">
          <div class="name">${p.Name}</div>
          <div class="meta">${p.Position} · Class of ${p.Class}</div>
          <div class="meta">${p.HeightWeight}</div>
          <div class="actions">
            <a class="btn profile" href="profile.html?name=${encodeURIComponent(p.Name)}">Profile</a>
            ${p.Twitter ? `<a class="btn twitter" href="${p.Twitter}" target="_blank">
              <i class="fa-brands fa-x-twitter"></i></a>` : ""}
          </div>
        </div>`;
    });
}

document.getElementById("search").addEventListener("input", render);
document.querySelectorAll(".filters button").forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".filters button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    activeClass = btn.dataset.class;
    render();
  };
});
</script>

</body>
</html>