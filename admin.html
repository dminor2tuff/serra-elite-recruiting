<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Serra Admin Tools</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script>
  if (sessionStorage.getItem("serraAdminAccess") !== "true") {
    window.location.href = "coach-login.html";
  }
</script>

<style>
  :root{--serra-red:#7a1419;--serra-dark:#4a0d10;}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:linear-gradient(180deg,var(--serra-dark),var(--serra-red));color:#fff;}
  .topbar{background:rgba(0,0,0,.35);backdrop-filter:blur(6px);padding:12px 16px;
    display:flex;justify-content:space-between;align-items:center;gap:12px;position:sticky;top:0;z-index:50;}
  .topbar a{color:#fff;text-decoration:none;font-weight:950}
  .wrap{max-width:1100px;margin:auto;padding:16px 14px 60px;}
  h1{margin:10px 0 10px;font-size:1.9rem;font-weight:950}
  .card{background:rgba(0,0,0,.35);border-radius:18px;padding:14px;box-shadow:0 10px 26px rgba(0,0,0,.35);}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:12px;}
  label{font-size:.85rem;opacity:.9;font-weight:900}
  input,textarea{width:100%;border:none;border-radius:12px;padding:10px 11px;font-size:.95rem;outline:none}
  textarea{min-height:96px;resize:vertical}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn{border:none;border-radius:999px;padding:10px 14px;font-weight:950;cursor:pointer}
  .btn.primary{background:#fff;color:var(--serra-red)}
  .btn.ghost{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.55);color:#fff}
  .list{margin-top:14px;display:grid;gap:10px}
  .item{background:rgba(255,255,255,.10);border-radius:14px;padding:12px;display:flex;justify-content:space-between;gap:12px;align-items:center}
  .item strong{font-weight:950}
  .muted{opacity:.85;font-size:.9rem}
  .codebox{background:rgba(0,0,0,.35);border-radius:14px;padding:12px;white-space:pre-wrap;font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>
<body>
  <div class="topbar">
    <div style="font-weight:950;">Admin Tools</div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <a href="recruits.html">Recruits</a>
      <a href="#" onclick="logout();return false;">Logout</a>
    </div>
  </div>

  <div class="wrap">
    <h1>Add or Edit Prospects</h1>

    <div class="card">
      <div class="grid">
        <div>
          <label>Name (must match recruits)</label>
          <input id="Name" placeholder="Last, First or First Last (your choice)"/>
        </div>
        <div>
          <label>Class</label>
          <input id="Class" placeholder="2026"/>
        </div>
        <div>
          <label>Position</label>
          <input id="Position" placeholder="DB / RB"/>
        </div>
        <div>
          <label>HeightWeight</label>
          <input id="HeightWeight" placeholder="5'10 / 184 lbs"/>
        </div>
        <div>
          <label>GPA</label>
          <input id="GPA" placeholder="3.2"/>
        </div>
        <div>
          <label>Offers</label>
          <input id="Offers" placeholder="3"/>
        </div>
        <div>
          <label>Status</label>
          <input id="Status" placeholder="Uncommitted"/>
        </div>
        <div>
          <label>College</label>
          <input id="College" placeholder="Target School"/>
        </div>
        <div>
          <label>HUDL</label>
          <input id="HUDL" placeholder="https://www.hudl.com/..."/>
        </div>
        <div>
          <label>Twitter</label>
          <input id="Twitter" placeholder="https://x.com/..." />
        </div>
        <div>
          <label>ImageURL (RAW GitHub URL)</label>
          <input id="ImageURL" placeholder="https://raw.githubusercontent.com/.../images/name.png"/>
        </div>
        <div>
          <label>CollegeLogo (optional)</label>
          <input id="CollegeLogo" placeholder="https://...logo.png"/>
        </div>
        <div style="grid-column:1/-1;">
          <label>Writeup</label>
          <textarea id="Writeup" placeholder="Full evaluation writeup..."></textarea>
        </div>
      </div>

      <div class="row">
        <button class="btn primary" onclick="save()">Save (Local)</button>
        <button class="btn ghost" onclick="clearForm()">Clear</button>
      </div>

      <div style="margin-top:14px;">
        <div class="muted" style="margin-bottom:8px;">
          Copy this row into Google Sheets to make it permanent:
        </div>
        <div id="sheetRow" class="codebox">Fill out the form and click Save to generate a row.</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <div style="font-weight:950;margin-bottom:6px;">Local Overrides Roster</div>
      <div class="muted">These entries merge on top of your Google Sheet for this browser.</div>
      <div id="list" class="list"></div>
      <div class="row" style="margin-top:12px;">
        <button class="btn ghost" onclick="exportJSON()">Export Local JSON</button>
        <button class="btn ghost" onclick="clearAll()">Clear All Local Overrides</button>
      </div>
    </div>
  </div>

<script>
  function logout(){
    sessionStorage.removeItem("serraCoachAccess");
    sessionStorage.removeItem("serraAdminAccess");
    window.location.href = "coach-login.html";
  }

  function getRoster(){
    try{ return JSON.parse(localStorage.getItem("serraLocalRoster") || "[]"); }
    catch(e){ return []; }
  }
  function setRoster(arr){
    localStorage.setItem("serraLocalRoster", JSON.stringify(arr));
  }

  function val(id){ return (document.getElementById(id).value || "").trim(); }
  function setVal(id,v){ document.getElementById(id).value = v || ""; }

  let editingName = null;

  function normalizeTwitter(url){
    if (!url) return "";
    url = String(url).trim();
    if (!url) return "";
    if (url.startsWith("@")) return "https://twitter.com/" + url.slice(1);
    if (url.startsWith("twitter.com/")) return "https://" + url;
    if (url.startsWith("x.com/")) return "https://" + url;
    return url;
  }

  function save(){
    const obj = {
      Name: val("Name"),
      Class: val("Class"),
      Position: val("Position"),
      HeightWeight: val("HeightWeight"),
      HUDL: val("HUDL"),
      Writeup: val("Writeup"),
      ImageURL: val("ImageURL"),
      Twitter: normalizeTwitter(val("Twitter")),
      GPA: val("GPA"),
      Offers: val("Offers"),
      Status: val("Status"),
      College: val("College"),
      CollegeLogo: val("CollegeLogo")
    };

    if(!obj.Name){
      alert("Name is required.");
      return;
    }

    const roster = getRoster();
    const idx = roster.findIndex(p => p.Name === (editingName || obj.Name));

    if(idx >= 0){
      roster[idx] = obj;
    } else {
      roster.push(obj);
    }
    setRoster(roster);

    editingName = obj.Name;
    buildSheetRow(obj);
    renderList();
    alert("Saved locally. If you want this permanent, copy the row into Google Sheets.");
  }

  function buildSheetRow(p){
    // CSV row in the same column order:
    // Name,Class,Position,HeightWeight,HUDL,Writeup,ImageURL,Twitter,GPA,Offers,Status,College,CollegeLogo
    const esc = (s) => {
      s = String(s||"");
      if (s.includes('"')) s = s.replaceAll('"','""');
      if (s.includes(",") || s.includes("\n") || s.includes("\r")) return `"${s}"`;
      return s;
    };
    const row = [
      p.Name,p.Class,p.Position,p.HeightWeight,p.HUDL,p.Writeup,p.ImageURL,p.Twitter,
      p.GPA,p.Offers,p.Status,p.College,p.CollegeLogo
    ].map(esc).join(",");

    document.getElementById("sheetRow").textContent = row;
  }

  function clearForm(){
    ["Name","Class","Position","HeightWeight","HUDL","Writeup","ImageURL","Twitter","GPA","Offers","Status","College","CollegeLogo"]
      .forEach(id => setVal(id,""));
    editingName = null;
    document.getElementById("sheetRow").textContent = "Fill out the form and click Save to generate a row.";
  }

  function edit(name){
    const p = getRoster().find(x => x.Name === name);
    if(!p) return;
    editingName = p.Name;
    Object.keys(p).forEach(k => { if(document.getElementById(k)) setVal(k,p[k]); });
    buildSheetRow(p);
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function remove(name){
    if(!confirm("Delete this local override?")) return;
    const roster = getRoster().filter(x => x.Name !== name);
    setRoster(roster);
    renderList();
  }

  function clearAll(){
    if(!confirm("Clear ALL local overrides in this browser?")) return;
    localStorage.removeItem("serraLocalRoster");
    renderList();
  }

  function exportJSON(){
    const data = JSON.stringify(getRoster(), null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "serraLocalRoster.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function renderList(){
    const list = document.getElementById("list");
    const roster = getRoster().sort((a,b)=> (a.Name||"").localeCompare(b.Name||""));
    list.innerHTML = "";

    if(!roster.length){
      list.innerHTML = `<div class="muted">No local overrides yet.</div>`;
      return;
    }

    roster.forEach(p => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div>
          <strong>${p.Name}</strong>
          <div class="muted">${p.Position || ""} Â· ${p.Class || ""}</div>
        </div>
        <div class="row" style="margin:0;">
          <button class="btn primary" onclick="edit('${p.Name.replaceAll("'","\\'")}')">Edit</button>
          <button class="btn ghost" onclick="remove('${p.Name.replaceAll("'","\\'")}')">Delete</button>
        </div>
      `;
      list.appendChild(div);
    });
  }

  renderList();
</script>
</body>
</html>