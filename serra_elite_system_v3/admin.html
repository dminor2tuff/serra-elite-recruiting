<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Serra Recruiting – Admin Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --serra-blue: #002b5c;
      --serra-red: #800000;
      --serra-light: #f5f7fb;
    }

    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--serra-light);
      color: #111;
    }

    .wrap {
      max-width: 1000px;
      margin: 20px auto 40px;
      padding: 0 16px;
    }

    .box {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      margin-bottom: 18px;
    }

    h1, h2 {
      color: var(--serra-blue);
    }

    label {
      font-size: 0.85rem;
      font-weight: 700;
      display: block;
      margin-top: 8px;
    }

    input, textarea {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 4px;
      font-size: 0.9rem;
    }

    textarea {
      min-height: 70px;
    }

    button {
      margin-top: 10px;
      padding: 8px 18px;
      border: none;
      border-radius: 999px;
      background: var(--serra-blue);
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .small {
      font-size: 0.85rem;
      color: #555;
    }

    #adminArea {
      display: none;
    }

    .row-list {
      max-height: 260px;
      overflow: auto;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 8px;
      font-size: 0.85rem;
      background: #fafbff;
    }

    .row-list div {
      padding: 3px 0;
      border-bottom: 1px solid #eee;
    }

    .row-list div span {
      font-weight: 700;
      color: var(--serra-blue);
      cursor: pointer;
    }

    code {
      background: #eef1f8;
      padding: 2px 4px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- LOGIN BOX -->
    <div class="box" id="loginBox">
      <h1>Serra Admin – Coach Tools</h1>
      <p class="small">
        Restricted to Serra Football staff. Use this area to build player rows,
        manage photos, and keep your Google Sheet clean.
      </p>
      <label for="pw">Coach Access Code</label>
      <input id="pw" type="password" placeholder="Enter password" />
      <button onclick="login()">Login</button>
      <p id="err" style="color:#b00020; display:none; margin-top:8px;">
        Incorrect password.
      </p>
    </div>

    <div id="adminArea">
      <!-- CURRENT PLAYERS VIEW -->
      <div class="box">
        <h2>Current Prospects (View / Load)</h2>
        <p class="small">
          Click on a name below to load it into the editor. To
          <strong>delete a player</strong>, remove their row from the Google Sheet directly.
        </p>
        <div id="playerRows" class="row-list">Loading…</div>
      </div>

      <!-- NEW / EDIT PLAYER BUILDER -->
      <div class="box">
        <h2>Player Row Builder</h2>
        <p class="small">
          Edit or add a player here. When finished, copy the generated row
          into your Google Sheet under the header row:<br />
          <code>
            Name | Class | Position | HeightWeight | HUDL | Writeup | ImageURL | Twitter | GPA
          </code>
        </p>

        <label>Name</label>
        <input id="pName" />

        <label>Class (e.g. 2026)</label>
        <input id="pClass" />

        <label>Position (e.g. DB / RB)</label>
        <input id="pPos" />

        <label>Height / Weight (e.g. 5'10 / 184 lbs)</label>
        <input id="pHW" />

        <label>HUDL URL</label>
        <input id="pHudl" />

        <label>Twitter URL</label>
        <input id="pTwitter" />

        <label>GPA</label>
        <input id="pGpa" />

        <label>Writeup</label>
        <textarea id="pWriteup"></textarea>

        <label>ImageURL</label>
        <input id="pImg" />

        <button onclick="buildRow()">Generate Sheet Row</button>

        <label style="margin-top:14px;">Copy-Paste into Google Sheet:</label>
        <textarea id="rowOutput" readonly></textarea>
      </div>

      <!-- IMAGE URL HELPER -->
      <div class="box">
        <h2>Player Photo Helper</h2>
        <p class="small">
          1. Upload player photos to your repo under
          <code>/images/</code>.<br />
          2. Example filenames:
          <code>devohn_moutra.png</code>,
          <code>joe_bolder.jpg</code><br />
          3. The public URL format is:<br />
          <code>
            https://dminor2tuff.github.io/serra-elite-recruiting/images/FILENAME
          </code>
        </p>

        <label>Example file name (e.g. devohn_moutra.png)</label>
        <input id="imgFile" />

        <button onclick="buildImageUrl()">Generate Example URL</button>

        <label style="margin-top:14px;">Use this in ImageURL column:</label>
        <textarea id="imgOutput" readonly></textarea>
      </div>

      <!-- TRANSCRIPT NOTE -->
      <div class="box">
        <h2>Transcript Requests</h2>
        <p class="small">
          Transcript requests from the main site can still point to
          <code>serracavsfb@gmail.com</code> from your index page buttons.
        </p>
      </div>
    </div>
  </div>

  <script>
    const SHEET_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZdfePIY8K8ag6AePllWRgYXhjJ-gJddB_8rDaJi3t5BAT11bHVK6m5cDsDQXg2PUIYPqHYcXyxbT2/pub?output=csv";
    const ADMIN_CODE = "Serrafb";
    let adminPlayers = [];

    function login() {
      const val = document.getElementById("pw").value.trim();
      if (val === ADMIN_CODE) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminArea").style.display = "block";
        document.getElementById("err").style.display = "none";
        loadAdminPlayers();
      } else {
        document.getElementById("err").style.display = "block";
      }
    }

    async function loadAdminPlayers() {
      const res = await fetch(SHEET_URL);
      const text = await res.text();
      const rows = text.split("\n").map((r) => r.split(","));
      const headers = rows[0];

      adminPlayers = rows
        .slice(1)
        .map((r) => {
          if (!r[0]) return null;
          const obj = {};
          headers.forEach((h, i) => (obj[h.trim()] = (r[i] || "").trim()));
          return obj;
        })
        .filter(Boolean);

      const list = document.getElementById("playerRows");
      list.innerHTML = "";
      adminPlayers.forEach((p, idx) => {
        const div = document.createElement("div");
        div.innerHTML = `<span data-idx="${idx}">${p.Name}</span> – Class ${p.Class} • ${p.Position}`;
        list.appendChild(div);
      });

      list.onclick = (e) => {
        const span = e.target.closest("span[data-idx]");
        if (!span) return;
        const idx = +span.dataset.idx;
        loadIntoEditor(adminPlayers[idx]);
      };
    }

    function loadIntoEditor(p) {
      document.getElementById("pName").value = p.Name || "";
      document.getElementById("pClass").value = p.Class || "";
      document.getElementById("pPos").value = p.Position || "";
      document.getElementById("pHW").value = p.HeightWeight || "";
      document.getElementById("pHudl").value = p.HUDL || "";
      document.getElementById("pTwitter").value = p.Twitter || "";
      document.getElementById("pGpa").value = p.GPA || "";
      document.getElementById("pWriteup").value = p.Writeup || "";
      document.getElementById("pImg").value = p.ImageURL || "";
      buildRow();
    }

    function buildRow() {
      const row = [
        document.getElementById("pName").value.trim(),
        document.getElementById("pClass").value.trim(),
        document.getElementById("pPos").value.trim(),
        document.getElementById("pHW").value.trim(),
        document.getElementById("pHudl").value.trim(),
        document.getElementById("pWriteup").value.trim(),
        document.getElementById("pImg").value.trim(),
        document.getElementById("pTwitter").value.trim(),
        document.getElementById("pGpa").value.trim(),
      ].join(" | ");

      document.getElementById("rowOutput").value = row;
    }

    function buildImageUrl() {
      const file = (document.getElementById("imgFile").value || "").trim();
      if (!file) {
        document.getElementById("imgOutput").value =
          "Enter a file name first, e.g. devohn_moutra.png";
        return;
      }
      const url =
        "https://dminor2tuff.github.io/serra-elite-recruiting/images/" + file;
      document.getElementById("imgOutput").value = url;
    }
  </script>
</body>
</html>